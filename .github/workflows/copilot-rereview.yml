name: Request Copilot Re-review

# Trigger on every push to PR (BMAD/Claude pushes)
on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  request-copilot:
    name: Request Copilot Review
    runs-on: ubuntu-latest

    # Skip for draft PRs (Copilot ruleset handles this)
    if: github.event.pull_request.draft == false

    permissions:
      pull-requests: write

    steps:
      - name: Request Copilot code review
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          PR_NUMBER=${{ github.event.pull_request.number }}

          echo "ðŸ¤– Requesting Copilot review for PR #$PR_NUMBER..."
          echo "Triggered by: ${{ github.event.action }} from ${{ github.actor }}"

          # Request Copilot as reviewer
          # Note: GitHub Copilot code review is handled via ruleset,
          # but this ensures it's explicitly requested after each push
          gh pr edit $PR_NUMBER --add-reviewer copilot 2>/dev/null || true

          echo "âœ… Copilot review requested for PR #$PR_NUMBER"
